{% extends "auctions/layout.html" %}

{% block body %}    
    <!-- add to watchlist form -->
    {% if user.is_authenticated %}
    <form action="{% url 'add-remove-watchlist' listing.id %}" method="POST">
      {% csrf_token %}
      <input type="submit" value="Add/Remove from watchlist" class="btn btn-sm btn-primary">
    </form>
    {{ watchlist_message }}

    {% if listing.status %}
      <!-- close listing if user created listing -->
      <form action="{% url 'close-listing' listing.id %}" method="POST">
        {% csrf_token %}
        <input type="submit" value="Close Listing">
      </form>
    {% endif %}

    {% endif %}
    <h2>{{ listing.title }}</h2>

    <div class="row listing-container">
      
      <div class="col-md-2">
        <img src="{{ listing.photo }}" alt="Photo of {{ listing.title }}" class="img-small">
      </div>
      <div class="col-md-10">
        <h4>${{ listing.price }}</h4>
        <p>{{ listing.description }}</p>
        <p>Listed: {{ listing.date }}</p>
        <p>Listed by: {{ listing.user.username }}</p>
      </div>
    </div>

    {% if user.is_authenticated %}

      {% if listing.status %}
      
      <h3>Place a bid:</h3>
      <form action="{% url 'bid' listing.id %}" method="POST">
        {% csrf_token %}
        <div class="form-group">
          <input type="number" step="0.01" required name="price" class="form-control" placeholder="Bid Amount">
        </div>
        <input type="submit" value="Submit" class="btn btn-sm btn-primary">
      </form>

      {% endif %}

      <h3>Bid History</h3>
      <table class="table table-striped">
        <tr>
          <th>Username</th>
          <th>Bid Amount</th>
        </tr>
      {% for bid in bids%}
        <tr>
          <td>{{ bid.bidder.username }}</td> 
          <td>${{ bid.price }}</td>
        </tr>
      {% endfor %}
      </table>
      
      <h3>Leave a Comment</h3>
      <form action="{% url 'comment' listing.id %}" method="POST">
        {% csrf_token %}
        <div class="form-group">
          <input type="text" required name="comment_text" class="form-control" placeholder="Comment">
        </div>
        <input type="submit" value="Submit" class="btn btn-sm btn-primary">
      </form>

      <h3>Comments</h3>
      <ul>
      {% for comment in comments %}
          <li>
            On {{ comment.date }}, {{ comment.user.username }} wrote:<br>
            {{ comment.comment }}
          </li>
      {% endfor %}
      </ul>

    {% else %}
    <p>(Sign in to bid,see bid history, and comments.)</p>  

    {% endif %}


{% endblock %}